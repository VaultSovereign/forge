<svg xmlns="http://www.w3.org/2000/svg" width="1280" height="860" viewBox="0 0 1280 860">
  <defs>
    <style>
      .box{fill:#0f172a;stroke:#94a3b8;stroke-width:1.5;rx:10;ry:10}
      .thin{fill:#0b1220;stroke:#64748b;stroke-width:1.2;rx:8;ry:8}
      .title{fill:#e2e8f0;font:600 16px/1.2 Inter,ui-sans-serif}
      .small{fill:#cbd5e1;font:500 13px/1.4 Inter,ui-sans-serif}
      .link{stroke:#7dd3fc;stroke-width:1.5;marker-end:url(#a)}
      .link2{stroke:#86efac;stroke-width:1.5;marker-end:url(#a)}
      .dim{fill:#94a3b8}
      .badge{fill:#1e293b;stroke:#475569;stroke-width:1;rx:6;ry:6}
    </style>
    <marker id="a" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" class="dim"/>
    </marker>
  </defs>

  <!-- Browser / SPA -->
  <rect x="40" y="40" width="480" height="210" class="box"/>
  <text x="60" y="70" class="title">Workbench Frontend (React + Vite, TypeScript)</text>
  <text x="60" y="100" class="small">• SPA only — no secrets in browser</text>
  <text x="60" y="120" class="small">• Talks to BFF via HTTPS (REST/GraphQL)</text>
  <text x="60" y="140" class="small">• Real-time logs over <tspan fill="#7dd3fc">SSE</tspan></text>
  <rect x="60" y="165" width="440" height="70" class="thin"/>
  <text x="80" y="190" class="small">UI Modules: Dashboard • Template Explorer/Studio (Monaco + JSON-Schema forms) • Execution Console • Ledger Visualizer</text>

  <!-- BFF -->
  <rect x="40" y="290" width="480" height="250" class="box"/>
  <text x="60" y="320" class="title">Workbench BFF (Fastify/Node, TypeScript)</text>
  <text x="60" y="350" class="small">• OIDC/JWT AuthN + RBAC AuthZ (operators, auditors, authors)</text>
  <text x="60" y="370" class="small">• REST/GraphQL: /v1/api/templates, /execute, /ledger/*</text>
  <text x="60" y="390" class="small">• Streams execution logs via SSE</text>

  <!-- Secrets + Config -->
  <rect x="60" y="410" width="210" height="110" class="thin"/>
  <text x="75" y="435" class="small">Pluggable Secrets Vault</text>
  <text x="75" y="455" class="small">• Env / HashiCorp Vault / K8s Secrets</text>
  <text x="75" y="475" class="small">• Never exposed to frontend</text>

  <rect x="300" y="410" width="200" height="110" class="thin"/>
  <text x="315" y="435" class="small">Policy &amp; RBAC</text>
  <text x="315" y="455" class="small">• OIDC provider config</text>
  <text x="315" y="475" class="small">• Role map &amp; scopes</text>

  <!-- Connections from Frontend to BFF -->
  <line x1="280" y1="250" x2="280" y2="290" class="link"/>
  <text x="292" y="275" class="small" fill="#7dd3fc">HTTPS + SSE</text>

  <!-- Core Services -->
  <rect x="620" y="290" width="600" height="250" class="box"/>
  <text x="640" y="320" class="title">Core vaultmesh-ai (@vaultmesh/ai-core)</text>
  <text x="640" y="350" class="small">• Dispatcher (runKeyword, validate, guardrails)</text>
  <text x="640" y="370" class="small">• Reality Ledger (append, verify, query) — append on success &amp; failure</text>
  <text x="640" y="390" class="small">• Programmatic library (TS) + gRPC server</text>

  <rect x="640" y="410" width="270" height="110" class="thin"/>
  <text x="655" y="435" class="small">gRPC Service (typed contracts)</text>
  <text x="655" y="455" class="small">• Execute(templateId, profile, args)</text>
  <text x="655" y="475" class="small">• Ledger: Append/Verify/Query</text>

  <rect x="930" y="410" width="270" height="110" class="thin"/>
  <text x="945" y="435" class="small">Reality Ledger Store</text>
  <text x="945" y="455" class="small">• JSONL shards + signatures</text>
  <text x="945" y="475" class="small">• Immutable, verifiable</text>

  <!-- BFF ↔ Core -->
  <line x1="520" y1="415" x2="620" y2="415" class="link2"/>
  <text x="540" y="405" class="small" fill="#86efac">gRPC (mTLS)</text>

  <!-- Providers (egress only from BFF/Core) -->
  <rect x="620" y="570" width="600" height="160" class="box"/>
  <text x="640" y="600" class="title">External Providers</text>
  <text x="640" y="625" class="small">• OpenAI / OpenRouter / Ollama (egress via BFF only)</text>
  <text x="640" y="645" class="small">• Keys fetched from Secrets Vault at call-time</text>

  <!-- Badges -->
  <rect x="40" y="770" width="1180" height="70" class="badge"/>
  <text x="60" y="815" class="small">Security Guarantees: no secret in browser • no direct provider calls from frontend • all actions ledgered (success + failure) • typed contracts over gRPC • SSE for auditable, simple streaming</text>
</svg>
