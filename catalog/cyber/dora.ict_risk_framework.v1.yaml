id: dora.ict_risk_framework.v1
version: "1.1.1"
keyword: cyber-dora-ict-risk
meta:
  title: "DORA ICT Risk Management Framework Assessment"
  safety: read-only
  tags: [ dora, ict, compliance, risk, audit ]
summary: >
  Evaluate an organisation’s ICT risk management framework in line with the
  Digital Operational Resilience Act (DORA). Aggregates evidence, policies, and
  system descriptions into an auditable JSON report with risk scoring and
  acceptance logic.
inputs:
  org_name:
    type: string
    required: true
  assessment_date:
    type: string
    format: date
    required: true
  org_type:
    type: string
    enum:
      [
        bank,
        insurance_company,
        investment_firm,
        credit_institution,
        payment_institution,
        electronic_money_institution,
        crypto_asset_service_provider,
        central_counterparty,
        trading_venue,
        central_securities_depository,
        data_reporting_service_provider,
        management_company,
        deposit_taking_credit,
        microenterprise,
        other
      ]
    required: true
  critical_functions:
    type: array
    items:
      type: string
  policies:
    type: array
    items:
      type: string
      description: "Evidence paths or filenames for ICT policies"
    required: true
  assets:
    type: array
    items:
      type: string
      description: "Critical asset inventory paths"
    required: true
  incidents:
    type: array
    items:
      type: string
      description: "Incident register or reports"
    required: true
  regions:
    type: array
    items:
      type: string
    description: "Jurisdictions in scope"
  notes:
    type: string
  third_parties:
    type: array
    items:
      type: string
    description: "Paths to third-party risk registers or DDQs"
  tests:
    type: array
    items:
      type: string
    description: "Paths to resilience testing artefacts"
outputs:
  result:
    type: object
  schema_ref: "file:../schemas/ict_risk.v1.json#/output_schema"
guardrails:
  schema_enforce: true
  temperature: 0.1
  max_tokens: 3000
prescan:
  name: ict-risk-collect
  description: Collect ICT policies, asset inventories, and incidents from provided paths
  run:
    shell: bash
    script: |
      set -euo pipefail
      : "${VM_ARGS_PATH:?}"
      : "${VM_PRESCAN_OUT:?}"
      if [ -f "dist/scripts/pre_scan/ict_risk_collect.js" ]; then
        node dist/scripts/pre_scan/ict_risk_collect.js "$VM_ARGS_PATH" > "$VM_PRESCAN_OUT"
      else
        npx --yes ts-node scripts/pre_scan/ict_risk_collect.ts "$VM_ARGS_PATH" > "$VM_PRESCAN_OUT"
      fi
  merge: replace_args
prompt:
  system: |
    You are a compliance assessor applying the DORA ICT Risk Management Framework. Evaluate ICT policies, asset inventories, incident registers, third-party artefacts, and testing evidence. Map findings to the DORA control families and output JSON conforming to the schema.

    **CRITICAL INSTRUCTIONS (NO EXCEPTIONS):**
    - Output strict JSON (no prose) with the following top-level keys only: `org_name`, `assessment_date`, `controls`, `overall_score`, `risk_summary_table`.
    - Copy `org_name` and `assessment_date` exactly from the inputs.
    - `controls` must be a non-empty array. Each control object MUST include `control_id` (one of DORA-IRM-01, DORA-INC-01, DORA-TRT-01, DORA-TPRM-01, DORA-GOV-01), `pillar` (matching the control’s pillar enumeration), `status` (Compliant | Partial | Non-Compliant), `risk_score` (number between 1 and 5), `risk_rationale` (string), and `evidence_paths` (array of strings referencing actual evidence).
    - Provide at least one control for each pillar when evidence is available; reference the supplied evidence files explicitly (full relative paths).
    - `overall_score` must be a numeric value between 0 and 5 (e.g., weighted mean of the control scores, rounded to one decimal place).
    - `risk_summary_table` must be a string path for a Markdown summary (e.g., `outputs/ict/{{org_name}}/risk_summary.md`).
    - **Do not emit `null`, `N/A`, or additional top-level properties.** If information is unavailable, use the closest supported value (e.g., default score/status with rationale).
  user: |
    Perform a DORA ICT Risk assessment for the organization "{{org_name}}" (type: {{org_type}}) as of assessment date {{assessment_date}}.

    Critical functions: {{#if critical_functions}}{{#each critical_functions}}"{{this}}"{{#unless @last}}, {{/unless}}{{/each}}{{else}}(not specified){{/if}}.
    Jurisdictions in scope: {{#if regions}}{{#each regions}}"{{this}}"{{#unless @last}}, {{/unless}}{{/each}}{{else}}(not specified){{/if}}.

    Evidence sources:
      - Policies: {{#if policies}}{{#each policies}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}{{else}}(none provided){{/if}}
      - Assets: {{#if assets}}{{#each assets}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}{{else}}(none provided){{/if}}
      - Incidents: {{#if incidents}}{{#each incidents}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}{{else}}(none provided){{/if}}
      - Third parties: {{#if third_parties}}{{#each third_parties}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}{{else}}(none provided){{/if}}
      - Resilience tests: {{#if tests}}{{#each tests}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}{{else}}(none provided){{/if}}

    Additional context: {{notes}}

    Produce a single JSON object that satisfies the instructions and the `ict_risk.v1.json` output schema exactly.
artifacts:
  - path: outputs/ict/{{org_name}}/ict_risk_report.json
  - path: outputs/ict/{{org_name}}/ict_risk_summary.md
