# VaultMesh Template Spec — DORA Third-Party Risk (TPRM) v1
id: dora.tprm.v1
title: "Third-Party Risk Assessment (DORA) — v1"
kind: spec
status: draft
owner: platform
safety:
  class: read-only
  data_access: advisory
  notes:
    - "Template performs analysis only; no external network effects."
    - "Intended for CI/PR review and auditor read-outs."
tags:
  - dora
  - tprm
  - fintech
  - compliance
summary: >
  Evaluate a vendor's third-party risk posture aligned to DORA. Aggregates evidence,
  maps to control families, scores risk, and emits an auditable JSON report suitable
  for the Reality Ledger.

inputs:
  schema:
    $schema: "http://json-schema.org/draft-07/schema#"
    type: object
    required: [vendor_name, criticality]
    additionalProperties: false
    properties:
      vendor_name:
        type: string
        minLength: 1
      criticality:
        type: string
        enum: [low, moderate, high, critical]
      business_services:
        type: array
        items: { type: string }
        description: "Business services the vendor supports (e.g., Payments, Trading)."
      data_categories:
        type: array
        items:
          type: string
          enum: [PII, PCI, PHI, Confidential, Internal, Public]
      regions:
        type: array
        items: { type: string }
        description: "Jurisdictions/hosting regions in scope (e.g., EU, UAE, IE)."
      evidence_paths:
        type: array
        items: { type: string }
        description: "Local repo globs with evidence (policies, DDQs, pentests)."
      questionnaires:
        type: array
        items: { type: string }
        description: "Path(s) to completed DDQs (JSON/YAML)."
      notes:
        type: string

scoring:
  factors:
    confidentiality: { weight: 0.22 }
    integrity:       { weight: 0.22 }
    availability:    { weight: 0.22 }
    resilience:      { weight: 0.18 }
    compliance:      { weight: 0.16 }
  aggregation: "weighted_sum_normalized_0_100"
  levels:
    - { level: low,       min: 0,  max: 29 }
    - { level: moderate,  min: 30, max: 59 }
    - { level: high,      min: 60, max: 79 }
    - { level: critical,  min: 80, max: 100 }

acceptance:
  pass_if:
    - "secrets.critical == 0"
    - "controls.coverage.dora >= 0.85"
    - "risk.level in ['low','moderate']"
  warn_if:
    - "risk.level == 'high'"
  fail_if:
    - "risk.level == 'critical'"

controls_map:
  dora:
    - id: "ICTRM.1"
      name: "ICT risk management framework"
    - id: "TPRM.1"
      name: "Third-party risk management lifecycle"
    - id: "IR.1"
      name: "Incident reporting & register"
    - id: "DR.1"
      name: "Operational resilience testing"
  iso27001:
    - "A.5 Information security policies"
    - "A.15 Supplier relationships"
    - "A.17 Information security aspects of business continuity"
  nist80053:
    - "RA-3, RA-5"
    - "SA-9, SA-12"
    - "CP-2, CP-9, CP-10"

output_schema:
  $schema: "http://json-schema.org/draft-07/schema#"
  type: object
  required: [vendor, risk, coverage, findings, recommendations, acceptance]
  properties:
    vendor:
      type: object
      properties:
        name: { type: string }
        criticality: { type: string, enum: [low, moderate, high, critical] }
        regions: { type: array, items: { type: string } }
        business_services: { type: array, items: { type: string } }
        data_categories: { type: array, items: { type: string } }
    risk:
      type: object
      required: [score, level]
      properties:
        score: { type: number, minimum: 0, maximum: 100 }
        level: { type: string, enum: [low, moderate, high, critical] }
        rationale: { type: string }
    coverage:
      type: object
      properties:
        dora:      { type: number, minimum: 0, maximum: 1 }
        iso27001:  { type: number, minimum: 0, maximum: 1 }
        nist80053: { type: number, minimum: 0, maximum: 1 }
    findings:
      type: array
      items:
        type: object
        required: [id, title, severity, control_ids]
        properties:
          id: { type: string }
          title: { type: string }
          severity: { type: string, enum: [info, low, medium, high, critical] }
          control_ids: { type: array, items: { type: string } }
          evidence: { type: array, items: { type: string } }
          recommendation: { type: string }
    recommendations:
      type: array
      items: { type: string }
    secrets:
      type: object
      properties:
        critical: { type: integer, minimum: 0 }
        high:     { type: integer, minimum: 0 }
        medium:   { type: integer, minimum: 0 }
    acceptance:
      type: object
      required: [pass, reasons]
      properties:
        pass: { type: boolean }
        reasons: { type: array, items: { type: string } }
    receipt:
      type: object
      description: "Reality Ledger receipt stub—fill on append."
      properties:
        event_id: { type: string }
        hash: { type: string }
        sig: { type: string }
        ts: { type: string, format: date-time }

example_invocation: |
  vm run dora.tprm.v1 -a '{
    "vendor_name": "AcmeCloud",
    "criticality": "high",
    "business_services": ["Payments"],
    "data_categories": ["PII","PCI"],
    "regions": ["EU","UAE","IE"],
    "evidence_paths": ["third_party/acme/**"],
    "questionnaires": ["vendor/ddq/acme-ddq.json"]
  }'

example_output: |
  {
    "vendor": {"name":"AcmeCloud","criticality":"high","regions":["EU","UAE","IE"]},
    "risk": {"score": 64, "level": "high", "rationale": "Gaps in incident reporting and BCDR"},
    "coverage": {"dora":0.78,"iso27001":0.82,"nist80053":0.70},
    "findings": [
      {"id":"TPRM-IR-01","title":"No TIBER-style test evidence","severity":"high","control_ids":["DR.1"],"evidence":["third_party/acme/pentest.pdf"],"recommendation":"Conduct scenario tests per DORA DR.1"},
      {"id":"TPRM-TP-02","title":"Sub-processor register incomplete","severity":"medium","control_ids":["TPRM.1"],"evidence":["vendor/ddq/acme-ddq.json#subprocessors"],"recommendation":"Publish full sub-processor list"}
    ],
    "recommendations": ["Add DORA incident register", "Rotate keys & document escrow"],
    "secrets": {"critical":0,"high":0,"medium":1},
    "acceptance": {"pass": false, "reasons": ["risk.level == 'high'","coverage.dora < 0.85"]},
    "receipt": {"event_id":"evt_xxx","hash":"sha256:...","ts":"2025-01-01T12:00:00Z"}
  }
